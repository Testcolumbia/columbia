<?xml version="1.0" encoding="UTF-8"?>
<project name="BuildDeployment" default="" basedir=".">
	<!--<delete dir="../Columbia_automation/downloadedbuilds"/>
<mkdir dir="../Columbia_automation/downloadedbuilds"/>-->
	<property file = "E:/Automation_WorkSpace/Columbia_automation/src/com/qa/columbia/ANT/build.properties"/>
	<property name="subject" value="Build Deployment Status"/>
	<property name="htmlsource" value="E:/Automation_WorkSpace/Columbia_automation/src/com/qa/columbia/results" />
	<property name="htmldest" value="E:/Automation_WorkSpace/Columbia_automation/src/com/qa/columbia/results/html.zip" />
	<property name="build_status_message" value="You can see the complete Batch execution report in the HTML.zip attached in mail"/>
	<property name="subject" value="Build Results"/>
	<property name="host" value="qasource.com"/>
	<property name="to" value="pkaur@qasource.com"/>
	<property name="from" value="pkaur@qasource.com"/>
	<property name="Buildno" value="154"/>
	<property name="V" value="6_0"/>	

	<target name="StopQumuService" description="Stop the Qumu JBoss Service.">
		<echo>Stop the Qumu service on remote machine </echo>
		<sshexec host="10.1.202.88"
		username="devuser"
		password="devuser123"
		command="cmd.exe /c sc stop QumuJBossService"/>
	</target>
	
	<!-- Delete the adminportal.war/viewerportal.war and serviceportal.war build directories on remote machine -->	
	   <target name="Clean" depends="StopQumuService" description="Removes previous build from remote machine" >
	    <echo>Delete the adminportal.war/viewerportal.war and serviceportal.war build directories on remote machine </echo>
	    <sshexec host="10.1.202.88" username="devuser" password="devuser123" trust="true" command="cmd.exe /c rd /s /q C:/Program\ \Files/Qumu/deploy1/**portal.war" />
		<!--  <echo>START @ deleting tmp,work,log</echo>
	     	<sshexec host="${Remote.Host}" username="${Remote.Host.Username}" password="${Remote.Host.Password}" trust="true" command="cmd.exe /c rd /s /q C:/Program\ \Files/Qumu/jboss/server/default/tmp" />
	      	<sshexec host="${Remote.Host}" username="${Remote.Host.Username}" password="${Remote.Host.Password}" trust="true" command="cmd.exe /c rd /s /q C:/Program\ \Files/Qumu/jboss/server/default/work" />
	       	<sshexec host="${Remote.Host}" username="${Remote.Host.Username}" password="${Remote.Host.Password}" trust="true" command="cmd.exe /c rd /s /q C:/Program\ \Files/Qumu/jboss/server/default/log" />
	     <echo> END @ deleting tmp,work,log</echo>  -->
	     	 
	    </target> 	
	
   <target name="DeployWarfiles" depends="Clean" description="deploy the war files.">
	<path id="jsch.path"> 
	<pathelement location="${ANT_HOME}/lib/ant-jsch.jar"/> 
	<pathelement location="${ANT_HOME}/lib/jsch*.jar"/> </path> 
   <!-- <sshexec host="10.1.202.88" username="devuser" password="devuser123" trust="true" command="cmd.exe /c MD C:/Program\ \Files/Qumu/deploy1/"/> -->
    	<scp todir="devuser:devuser123@10.1.202.88:C:/Program\ \Files/Qumu/deploy1/" trust="true" verbose="true">
			<fileset dir = "downloadedbuilds">  	          
		 <include name="**/**" />
	</fileset> 
    </scp>
 </target> 
	
<target name="StartQumuService" depends="DeployWarfiles" description="Start the Qumu JBoss Service.">
<sshexec host="10.1.202.88"
	username="devuser"
	password="devuser123"
	command="cmd.exe /c sc start QumuJBossService"/>
</target>

<!-- run the ant timestamp task -->

<tstamp>
 <format property="TODAY" pattern="d-MMMM-yyyy"/>
</tstamp>
<target name="sendMail_builddeployed" depends="StartQumuService" description="send email after successful deployment">
	<mail mailhost="${host}" tolist="${to}" cclist="narekumar@qasource.com,narkumar@qasource.com,gsingh@qasource.com" bcclist="pkaur@qasource.com" subject="${subject}-${TODAY}">
				<message>
					Hi All,

					Latest build V${V}#Patch${Buildno} has been deployed successfully.
					
					Please Note: This email is auto-generated by ANT after the build has been deployed successfully.
										
					Thanks,
					Columbia team
					columbia@qasource.com
					-We recommend this email id to be used for any correspondence with the India team. 
				</message>
			<from address="${from}"/>
				
			</mail> 
		</target>
	
	
	
</project>
